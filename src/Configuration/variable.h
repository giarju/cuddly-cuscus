#ifndef VARIABLE_H
#define VARIABLE_H

/*************************** Library  **********************************/
#include "string.h"
#include "Path/Path.h"
#include "Tracking/Tracking.h"
#include "InverseKinematics/InverseKinematics.h"
#include "JoystickPS3/JoystickPS3.h"
#include "PID/PID.h"
#include "millis/millis.h"

 
/*************************** Timer  **********************************/

/* timer  dan ticker untuk mengukur waktu */

/* profiler         : mengukur lama waktu suatu potongan program dijalankan */
Timer profiler;
/* interupsi sampling odometri*/
Ticker odometry_ticker;  
/* interupsi sampling encoder motor*/    
Ticker encoder_motor_ticker;
/* interupsi sampling serial print*/
Ticker serial_ticker;
/* interupsi sampling motor base*/
Ticker motor_ticker;
/* interupsi sampling tracking*/
Ticker tracking_ticker;
/* interupsi sampling pid motor base*/
Ticker pid_motor_ticker;

Ticker stick_ticker;

Ticker simul_ticker;

/* variable untuk menyimpan waktu 
 * prof_start1 : menyimpan waktu awal 
 * prof_end1   : menyimpan waktu akhir
 * diff1       : perbedaan awal dan akhir*/
uint32_t prof_start1, prof_end1, diff1;

/* variable untuk menyimpan waktu terakhir sampling
 *
 * @param lastTimeTangan : sampling tangan 
 * @param last_time_joystick   : sampling terakhir joystick
 * @param joysamptime       : sampling time joystick
 */
uint32_t lastTimeTangan, last_time_joystick;
float joysamptime;



/********************** Pergerakan Base ******************************/

/* variable untuk menyimpan kecepatan motor base 
 *  */

/* x_motor_speed : kecepatan aktual motor */
float a_motor_speed,b_motor_speed,c_motor_speed,d_motor_speed,right_arm_speed,left_arm_speed;
/* x_target_speed: kecepatan target motor 
 * x_next_speed : kecepatan target berikutnya 
 * */
float a_target_speed,b_target_speed,c_target_speed,d_target_speed;
float a_next_speed,b_next_speed,c_next_speed,d_next_speed;

/* X_pwm         : pwm yang diberikan ke motor*/
float A_pwm,B_pwm,C_pwm,D_pwm;
float A_pwm_dzcompensated,B_pwm_dzcompensated,C_pwm_dzcompensated,D_pwm_dzcompensated;

/* variable untuk menyimpan `trajectory */

/* i-th point dari map trajectory*/
int index_curr_pos;
/* i-th point dari map trajectory*/
int index_next_pos;

/* kecapatan base, berisi nilai vx,vy,omega*/
Coordinate base_speed;
Coordinate base_prev_speed;

/*pembacaan kecepatan base_motor*/
float v_resultan;

/*pembacaan sudut dari current position ke titik target */
float alpha;

/********************** PID Motor ******************************/

/* Objek untuk melakukan PID motor */ 

/* PID untuk motor A base (mode PID) */
PID A_pid_motor(A_kp, A_ki, A_kd, A_N, A_TS, A_kf1, A_kf2, A_kf3, A_kf4, PID::PI_MODE);
/* PID untuk motor B base (mode PID) */
PID B_pid_motor(B_kp, B_ki, B_kd, B_N, B_TS, B_kf1, B_kf2, B_kf3, B_kf4, PID::PI_MODE);
/* PID untuk motor C base (mode PID) */
PID C_pid_motor(C_kp, C_ki, C_kd, C_N, C_TS, C_kf1, C_kf2, C_kf3, C_kf4, PID::PI_MODE);
/* PID untuk motor D base (mode PID) */
PID D_pid_motor(D_kp, D_ki, D_kd, D_N, D_TS, D_kf1, D_kf2, D_kf3, D_kf4, PID::PI_MODE);


/********************** Komunikasi ******************************/

/* variable untuk melakukan komunikasi UART dengan double buffer */

/* buffer yang dibaca hardware dan dikirimkan melalui UART
 * maks ukuran string 64 karakter*/ 
char uart_buffer[64];
/* buffer yang ditulis oleh user
 * maks ukuran string 64 karakter*/ 
char str_buffer[64];
/* pointer untuk menunjuk address uart_buffer*/ 
char* uart_pointer;
/* panjang string yang dikirimkan user*/ 
int8_t uart_buff_len;

/* mutex untuk critical section UART*/
PlatformMutex uart_mutex; 

/********************** Pneumatic ******************************/
bool state_kiri;

int count_print = 0;
        int count_select = 0;

/********************** Joystick Press ******************************/
bool stick_kanan; bool stick_kiri; bool stick_atas; bool stick_bawah;
bool stick_segitiga; bool stick_lingkaran; bool stick_silang; bool stick_kotak;
bool stick_R1; bool stick_R2; bool stick_L1; bool stick_L2;
bool stick_select; bool stick_start; 




/********************** Other ******************************/
// float speed_array_a[400];
// float speed_array_b[400];
// float speed_array_c[400];
// float speed_array_d[400];
// float time_array[400];
uint32_t time_s = 0;

int statePrint;

float fwd[] = {0,0.000133799645,0.000401398935,0.00080279787,0.00133799645,0.002006994675,0.002809792545,0.00374639006,0.00481678722,0.006020984025,0.007358980475,0.00883077657,0.01043637231,0.012175767695,0.014048962725,0.0160559574,0.01819675172,0.020471345685,0.022879739295,0.02542193255,0.02809792545,0.030907717995,0.033851310185,0.03692870202,0.0401398935,0.043484884625,0.046963675395,0.05057626581,0.05432265587,0.058202845575,0.062216834925,0.06636462392,0.07064621256,0.075061600845,0.079610788775,0.08429377635,0.0891105635700001,0.0940611504350001,0.0991455369450001,0.1043637231,0.1097157089,0.115201494345,0.120821079435,0.12657446417,0.13246164855,0.138482632575,0.144637416245,0.15092599956,0.15734838252,0.163904565125,0.170594547375,0.17741832927,0.18437591081,0.191467291995,0.198692472825,0.2060514533,0.21354423342,0.221170813185,0.228931192595,0.23682537165,0.24485335035,0.253015128695,0.261310706685,0.26974008432,0.2783032616,0.287000238525,0.295831015095,0.30479559131,0.31389396717,0.323126142675,0.332492117825,0.34199189262,0.35162546706,0.361392841145,0.371294014875,0.38132898825,0.39149776127,0.401800333935,0.412236706245,0.4228068782,0.4335108498,0.444348621045,0.455320191935,0.46642556247,0.47766473265,0.489037702475,0.500544471945,0.51218504106,0.52395940982,0.535867578225,0.547909546275,0.56008531397,0.57239488131,0.584838248295001,0.597415414925,0.610126381200001,0.622971147120001,0.635815913040001,0.648660678960001,0.661505444880001,0.674350210800001,0.687194976720001,0.700039742640001,0.712884508560001,0.725729274480001,0.738574040400001,0.751418806320001,0.764263572240001,0.777108338160001,0.789953104080001,0.802797870000001,0.815642635920001,0.828487401840001,0.841332167760002,0.854176933680002,0.867021699600002,0.879866465520002,0.892711231440002,0.905555997360002,0.918400763280002,0.931245529200002,0.944090295120002,0.956935061040002,0.969779826960002,0.982624592880002,0.995469358800002,1.00831412472,1.02115889064,1.03400365656,1.04684842248,1.0596931884,1.07253795432,1.08538272024,1.09822748616,1.11107225208,1.123917018,1.13676178392,1.14960654984,1.16245131576,1.17529608168,1.1881408476,1.20098561352,1.21383037944,1.22667514536,1.23951991128,1.2523646772,1.26520944312,1.27805420904,1.29089897496,1.30374374088,1.3165885068,1.32943327272,1.34227803864,1.35512280456,1.36796757048,1.3808123364,1.39365710232,1.40650186824,1.41934663416,1.43219140008,1.445036166,1.45788093192,1.47072569784,1.48357046376,1.49641522968,1.5092599956,1.52210476152,1.53494952744,1.54779429336,1.56063905928,1.5734838252,1.58632859112,1.59917335704,1.61201812296,1.62486288888,1.6377076548,1.65055242072,1.66339718664,1.67624195256,1.68908671848,1.7019314844,1.71477625032,1.72762101624,1.74046578216,1.75331054808,1.766155314,1.77900007992,1.79184484584,1.80468961176,1.81753437768,1.8303791436,1.84322390952,1.85606867544,1.86891344136,1.881624407635,1.894201574265,1.90664494125,1.91895450859,1.931130276285,1.943172244335,1.95508041274,1.9668547815,1.978495350615,1.990002120085,2.00137508991,2.01261426009,2.023719630625,2.034691201515,2.04552897276,2.05623294436,2.066803116315,2.077239488625,2.08754206129,2.09771083431,2.107745807685,2.117646981415,2.1274143555,2.13704792994,2.146547704735,2.155913679885,2.16514585539,2.17424423125,2.183208807465,2.192039584035,2.20073656096,2.20929973824,2.217729115875,2.226024693865,2.23418647221,2.24221445091,2.250108629965,2.257869009375,2.26549558914,2.27298836926,2.280347349735,2.287572530565,2.29466391175,2.30162149329,2.308445275185,2.315135257435,2.32169144004,2.328113823,2.334402406315,2.340557189985,2.34657817401,2.35246535839,2.358218743125,2.363838328215,2.36932411366,2.37467609946,2.379894285615,2.384978672125,2.38992925899,2.39474604621,2.399429033785,2.403978221715,2.40839361,2.41267519864,2.416822987635,2.420836976985,2.42471716669,2.42846355675,2.432076147165,2.435554937935,2.43889992906,2.44211112054,2.445188512375,2.448132104565,2.45094189711,2.45361789001,2.456160083265,2.458568476875,2.46084307084,2.46298386516,2.464990859835,2.466864054865,2.46860345025,2.47020904599,2.471680842085,2.473018838535,2.47422303534,2.4752934325,2.476230030015,2.477032827885,2.47770182611,2.47823702469,2.478638423625,2.478906022915,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.47903982256,2.478906022915,2.478638423625,2.47823702469,2.47770182611,2.477032827885,2.476230030015,2.4752934325,2.47422303534,2.473018838535,2.471680842085,2.47020904599,2.46860345025,2.466864054865,2.464990859835,2.46298386516,2.46084307084,2.458568476875,2.456160083265,2.45361789001,2.45094189711,2.448132104565,2.445188512375,2.44211112054,2.43889992906,2.435554937935,2.432076147165,2.42846355675,2.42471716669,2.420836976985,2.416822987635,2.41267519864,2.40839361,2.403978221715,2.399429033785,2.39474604621,2.38992925899,2.384978672125,2.379894285615,2.37467609946,2.36932411366,2.363838328215,2.358218743125,2.35246535839,2.34657817401,2.340557189985,2.334402406315,2.328113823,2.32169144004,2.315135257435,2.308445275185,2.30162149329,2.29466391175,2.287572530565,2.280347349735,2.27298836926,2.26549558914,2.257869009375,2.250108629965,2.24221445091,2.23418647221,2.226024693865,2.217729115875,2.20929973824,2.20073656096,2.192039584035,2.183208807465,2.17424423125,2.16514585539,2.155913679885,2.146547704735,2.13704792994,2.1274143555,2.117646981415,2.107745807685,2.09771083431,2.08754206129,2.077239488625,2.066803116315,2.05623294436,2.04552897276,2.034691201515,2.023719630625,2.01261426009,2.00137508991,1.990002120085,1.978495350615,1.9668547815,1.95508041274,1.943172244335,1.931130276285,1.91895450859,1.90664494125,1.894201574265,1.881624407635,1.86891344136,1.85606867544,1.843090109875,1.83011154431,1.817132978745,1.80415441318,1.791175847615,1.77819728205,1.765218716485,1.75224015092,1.739261585355,1.72628301979,1.713304454225,1.70032588866,1.687347323095,1.67436875753,1.661390191965,1.6484116264,1.635433060835,1.62245449527,1.609475929705,1.59649736414,1.583518798575,1.57054023301,1.557561667445,1.54458310188,1.531604536315,1.51862597075,1.505647405185,1.49266883962,1.479690274055,1.46671170849,1.453733142925,1.44075457736,1.427776011795,1.41479744623,1.40181888066499,1.38884031509999,1.37586174953499,1.36288318396999,1.34990461840499,1.33692605283999,1.32394748727499,1.31096892170999,1.29799035614499,1.28501179057999,1.27203322501499,1.25905465944999,1.24607609388499,1.23309752831999,1.22011896275499,1.20714039718999,1.19416183162499,1.18118326605999,1.16820470049499,1.15522613492999,1.14224756936499,1.12926900379999,1.11629043823499,1.10331187266999,1.09033330710499,1.07735474153999,1.06437617597499,1.05139761040999,1.03841904484499,1.02544047927999,1.01246191371499,0.999483348149992,0.986504782584992,0.973526217019992,0.960547651454992,0.947569085889992,0.934590520324992,0.921611954759992,0.908633389194992,0.895654823629992,0.882676258064992,0.869697692499992,0.856719126934992,0.843740561369992,0.830761995804992,0.817783430239992,0.804804864674992,0.791826299109992,0.778847733544992,0.765869167979992,0.752890602414992,0.739912036849992,0.726933471284992,0.713954905719992,0.700976340154992,0.687997774589992,0.675019209024992,0.662040643459992,0.649062077894992,0.636083512329992,0.623104946764992,0.610126381199992,0.597147815634992,0.584303049714992,0.571592083439992,0.559014916809992,0.546571549824992,0.534261982484992,0.522086214789992,0.510044246739992,0.498136078334992,0.486361709574992,0.474721140459992,0.463214370989992,0.451841401164992,0.440602230984992,0.429496860449992,0.418525289559992,0.407687518314992,0.396983546714992,0.386413374759992,0.375977002449992,0.365674429784992,0.355505656764992,0.345470683389992,0.335569509659992,0.325802135574992,0.316168561134992,0.306668786339992,0.297302811189992,0.288070635684992,0.278972259824992,0.270007683609992,0.261176907039992,0.252479930114992,0.243916752834992,0.235487375199992,0.227191797209992,0.219030018864992,0.211002040164992,0.203107861109992,0.195347481699992,0.187720901934992,0.180228121814992,0.172869141339992,0.165643960509992,0.158552579324992,0.151594997784992,0.144771215889992,0.138081233639992,0.131525051034992,0.125102668074992,0.118814084759992,0.112659301089992,0.106638317064992,0.100751132684992,0.0949977479499918,0.0893781628599918,0.0838923774149918,0.0785403916149918,0.0733222054599918,0.0682378189499918,0.0632872320849918,0.0584704448649918,0.0537874572899918,0.0492382693599918,0.0448228810749918,0.0405412924349918,0.0363935034399918,0.0323795140899918,0.0284993243849918,0.0247529343249918,0.0211403439099918,0.0176615531399918,0.0143165620149918,0.0111053705349918,0.00802797869999179,0.00508438650999179,0.00227459396499179,-0.000401398935008211,-0.00294359219000821,-0.00535198580000821,-0.00762657976500821,-0.00976737408500821,-0.0117743687600082,-0.0136475637900082,-0.0153869591750082,-0.0169925549150082,-0.0184643510100082,-0.0198023474600082,-0.0210065442650082,-0.0220769414250082,-0.0230135389400082,-0.0238163368100082,-0.0244853350350082,-0.0250205336150082,-0.0254219325500082,-0.0256895318400082,-0.0258233314850082,-0.0258233314850082};


#endif